# WARNING - Generated by {fusen} from dev/flat_first.Rmd: do not edit by hand

#' container stats
#' 
#' show the container stats in a data.frame
#' @param base_command the base command 
#' @param additional additional command
#' @param use_podman logit, use podman as  backend when it is TRUE
#' @return data.frame
#' 
#' @export
#' @examples
#' docker_stats()
docker_stats <- function(base_command = "docker stats --no-stream",
                    additional = NA, use_podman = FALSE){
  
  if (!is.na(additional)){
    commandline <- glue::glue("{base_command} {additional}")
  } else {
    commandline <- base_command
  }
  if (use_podman) {
    commandline = stringr::str_replace(commandline,"docker","podman")
  }
  message(glue::glue("info\\ your command is {commandline},runing..."))
  output <- system(command = commandline,
                   intern = TRUE)
  header <- output[1]
  data_lines <- output[-1]
  data <- do.call(rbind, lapply(data_lines, function(x) {
    strsplit(x, "\\s{2,}")[[1]]
  }))
  header_clean <- strsplit(header, "\\s{2,}")[[1]]
  if (ncol(data) == length(header_clean)) {
    colnames(data) <- header_clean
    data <- as.data.frame(data)
    return(data)
  }else{
    message("something went wrong, check your command")
    return(NA)
  }
}
